# gulp-rev-urls

Gulp plugin for replacing URLs based on a manifest, especially well-suited for revving asset URLs. Handles relative URLs and is compatible with virtually any manifest format e.g. `gulp-rev` or `gulp-hasher`.

https://github.com/derit/gulp-rev-urls

## Install:

`npm install --save-dev https://github.com/derit/gulp-rev-urls

## Usage:

```js
var revUrls = require('gulp-rev-urls');
var urlOptions = {manifest: 'manifest.json'};
gulp.src('src/**/*.html')
    .pipe(revUrls(urlOptions))
    .pipe(gulp.dest('dist'))
```

Note: this plugin does not support streaming.

## Options

Note: In callback functions, `settings` refers to the default options, overridden by any given options.

### options.manifest : `object | string`

Maps original URLs to revised URLs. If passed as a string, `manifest` is interpreted as a file path and parsed into an object with `options.parse`.

example:

```js
{
    "foo.jpg": "foo-a43eas.jpg",
    "foo.css": "foo.css-aa2w3a"
}
```

When `manifest` requires some alteration prior to replacing URLs, use `options.transform`.

Defaults to: `{}`

### options.parse : `function (contents, settings) : object`

Parses the contents of the file specified by `options.manifest` into an object.

Defaults to: `JSON.parse`

### options.transform : `function (object, key, value, settings) : void`

Applies transformation function for each key-value pair in `options.manifest`. The supplied function should create a new entry in `object` corresponding to `key` and `value`.

See examples below for handling manifests generated by `gulp-rev` and `gulp-hasher`.

Defaults to: `null`

### options.pattern : `RegExp`

Identifies URLs in source text that may require revision. The contents of each file is searched for `pattern` and the first non-empty capture group is passed to `options.revise` for replacement. Thus `pattern` should contain at least one capture group.

Defaults to: `/(?:url\(["']?(.+?)['"]?\)|\s(?:src|href)=["'](.+?)['"])/g`

### options.revise : `function (originalUrl, expandedUrl, manifest, settings) : string`

Revises and returns a single URL that matched a capture group of `options.pattern`. To retain the original URL, simply return `originalUrl`.

The `expandedUrl` argument reflects the root-relative or absolute `originalUrl` after resolving any relative path segments i.e. `..` or `.`.

For example, to modif or add domain to original file hash

```js
var urlOptions = {
        manifest: {
            'bar.jpg': 'bar-affa23.jpg'
        },
        transform: function (obj, key, val) {
            obj[key] =  "https://your-cdn.com/asset/dist/"+val
        }
        
    }
```

Defaults to: `manifest[fullUrl] || origUrl`
 
### options.debug : `boolean`

When true, verbose logs are printed to console.

Defaults to: `false`
 

## License
MIT 
